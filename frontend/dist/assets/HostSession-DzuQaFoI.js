import{c as de,r as t,j as e,M as ue,h as xe,l as me,b as he,u as pe,n as be,z as S}from"./index-D94il1hI.js";import"./api-DRyY-k3C.js";import{q as F}from"./quizService-Dx9Ufqno.js";import{s as o}from"./socketService-B9_9EspU.js";const ge=de("Send",[["path",{d:"m22 2-7 20-4-9-9-4Z",key:"1q3vgg"}],["path",{d:"M22 2 11 13",key:"nzbqef"}]]),fe=({duration:c=60,onTimeUp:a,isPaused:i=!1})=>{const[x,y]=t.useState(c),[l,f]=t.useState(!i);t.useEffect(()=>{let h;return l&&x>0&&(h=setInterval(()=>{y(j=>j<=1?(clearInterval(h),a&&a(),0):j-1)},1e3)),()=>clearInterval(h)},[l,x,a]),t.useEffect(()=>{f(!i)},[i]);const m=h=>{const j=Math.floor(h/60),C=h%60;return`${j.toString().padStart(2,"0")}:${C.toString().padStart(2,"0")}`},w=()=>x/c*100,d=()=>x>c/2?"green":x>c/4?"orange":"red";return e.jsxs("div",{className:"quiz-timer-container",children:[e.jsx("div",{className:"timer-display",children:e.jsx("div",{className:"timer-circle",style:{borderColor:d(),background:`conic-gradient(${d()} ${w()}%, #eee ${w()}%)`},children:e.jsx("span",{className:"timer-text",children:m(x)})})}),e.jsxs("div",{className:"timer-controls",children:[e.jsx("button",{onClick:()=>f(!l),className:"control-button",children:l?"Pause":"Resume"}),e.jsx("button",{onClick:()=>{y(c),f(!0)},className:"control-button reset-button",children:"Reset"})]}),e.jsxs("div",{className:"timer-info",children:[e.jsxs("p",{children:["Time Remaining: ",m(x)]}),e.jsxs("p",{children:["Total Duration: ",m(c)]})]})]})},je=()=>{const[c,a]=t.useState(!1),[i,x]=t.useState(!1),[y,l]=t.useState([]),[f,m]=t.useState(null),[w,d]=t.useState(.9),[h,j]=t.useState(1),C=t.useRef(null);t.useEffect(()=>{const p=()=>{const u=window.speechSynthesis.getVoices();l(u);const b=u.find(v=>v.lang.startsWith("en")&&v.name.includes("Google"))||u.find(v=>v.lang.startsWith("en"));m(b||u[0])};return p(),window.speechSynthesis.onvoiceschanged!==void 0&&(window.speechSynthesis.onvoiceschanged=p),()=>{window.speechSynthesis.cancel()}},[]);const E=t.useCallback((p,u={})=>{if(!i||!p)return;window.speechSynthesis.cancel();const b=new SpeechSynthesisUtterance(p);b.voice=f,b.rate=u.rate||w,b.pitch=u.pitch||h,b.volume=u.volume||1,b.onstart=()=>{a(!0)},b.onend=()=>{a(!1)},b.onerror=v=>{console.error("Speech synthesis error:",v),a(!1)},C.current=b,window.speechSynthesis.speak(b)},[i,f,w,h]),z=t.useCallback(()=>{window.speechSynthesis.cancel(),a(!1)},[]),Q=t.useCallback(()=>{c&&window.speechSynthesis.pause()},[c]),q=t.useCallback(()=>{window.speechSynthesis.paused&&window.speechSynthesis.resume()},[]),N=t.useCallback(()=>{x(p=>(p&&(window.speechSynthesis.cancel(),a(!1)),!p))},[]);return{speak:E,stop:z,pause:Q,resume:q,toggleSpeech:N,isSpeaking:c,speechEnabled:i,setSpeechEnabled:x,voices:y,selectedVoice:f,setSelectedVoice:m,speechRate:w,setSpeechRate:d,speechPitch:h,setSpeechPitch:j}},ye=({messages:c=[],onSendMessage:a,disabled:i=!1,currentUser:x})=>{const[y,l]=t.useState(""),f=t.useRef(null),m=()=>{f.current?.scrollIntoView({behavior:"smooth"})};t.useEffect(()=>{m()},[c]);const w=d=>{d.preventDefault(),y.trim()&&!i&&(a(y),l(""))};return e.jsxs("div",{className:"flex flex-col h-full bg-white/50 backdrop-blur-sm",children:[e.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-3 custom-scrollbar",children:[c.length===0?e.jsxs("div",{className:"text-center text-gray-500 py-8 flex flex-col items-center",children:[e.jsx(ue,{size:32,className:"mb-2 opacity-50"}),e.jsx("p",{className:"text-sm",children:"No messages yet."}),e.jsx("p",{className:"text-xs",children:"Start the conversation!"})]}):c.map((d,h)=>{const j=d.userId===(x?.id||x?._id);return e.jsxs("div",{className:`flex flex-col ${j?"items-end":"items-start"}`,children:[e.jsxs("div",{className:`flex items-center gap-1 mb-1 ${j?"flex-row-reverse":"flex-row"}`,children:[e.jsx("span",{className:"text-xs font-bold text-gray-600",children:d.username}),d.isHost&&e.jsx("span",{className:"text-xs bg-blue-100 text-blue-700 px-1.5 py-0.5 rounded-full",children:"HOST"}),e.jsx("span",{className:"text-[10px] text-gray-400",children:new Date(d.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),e.jsx("div",{className:`px-3 py-2 rounded-xl max-w-[85%] break-words shadow-sm text-sm ${j?"bg-blue-600 text-white rounded-tr-none":d.isHost?"bg-blue-50 border border-blue-200 text-gray-800 rounded-tl-none":"bg-white border border-gray-100 text-gray-800 rounded-tl-none"}`,children:d.message||d.text})]},h)}),e.jsx("div",{ref:f})]}),e.jsx("form",{onSubmit:w,className:"p-3 bg-white border-t border-gray-100",children:e.jsxs("div",{className:"relative",children:[e.jsx("input",{type:"text",value:y,onChange:d=>l(d.target.value),placeholder:i?"Chat disabled":"Type a message...",disabled:i,className:"w-full pl-4 pr-10 py-2.5 bg-gray-50 border border-gray-200 rounded-xl focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent transition-all disabled:opacity-50 disabled:cursor-not-allowed text-sm"}),e.jsx("button",{type:"submit",disabled:!y.trim()||i,className:"absolute right-2 top-1/2 -translate-y-1/2 p-1.5 text-blue-600 hover:bg-blue-50 rounded-lg transition-colors disabled:opacity-50 disabled:hover:bg-transparent",children:e.jsx(ge,{size:16})})]})})]})},Qe=()=>{const c=xe(),{roomCode:a}=me(),{user:i,token:x}=he(),{currentQuiz:y}=pe(),[l,f]=t.useState(a||""),[m,w]=t.useState([]),[d,h]=t.useState(!1),[j,C]=t.useState(0),[E,z]=t.useState(!0),[Q,q]=t.useState(null),[N,p]=t.useState("lobby"),[u,b]=t.useState(null),[v,T]=t.useState(30),[$,W]=t.useState(!0),[L,P]=t.useState([]),[A,M]=t.useState(0),[we,_]=t.useState(null),[Ne,H]=t.useState(null),[B,U]=t.useState([]);t.useEffect(()=>((async()=>{try{z(!0),q(null);let g=a,J=null,Se="",D=0;if(a){console.log("Restoring session:",a);const s=await F.getQuizById(a).catch(()=>null)}if(o.connect(x),a)o.joinSession(a,i?.username||"Host"),f(a);else{const s=y||JSON.parse(localStorage.getItem("currentQuiz"));if(!s||!s._id)throw new Error("Quiz data not found");const n=await F.createSession({quizId:s._id,name:s.title,description:s.description,settings:{maxPlayers:100,questionTime:s.questions?.[0]?.timeLimit||30,showLeaderboard:!0,allowLateJoin:!0,randomizeQuestions:!1}});g=n.roomCode,J=n._id,D=n.quiz?.totalQuestions||s.questions?.length||0,f(g),_(J),M(D),o.joinSession(g,i?.username||"Host")}const se=s=>{console.log("Participant joined:",s),w(n=>n.find(R=>R.userId===s.participant.userId)?n:(S.success(`${s.participant?.username||"A player"} joined`),[...n,s.participant]))},te=s=>{w(n=>n.filter(k=>k.userId!==s.userId)),S(`${s.username||"A player"} left`,{icon:"ðŸ‘‹"})},ne=s=>{const n={...s.question};n?.options&&!Array.isArray(n.options)&&(n.options=Object.values(n.options)),h(!0),p("question"),b(n),C(s.questionIndex),T(s.timeRemaining||30),M(s.totalQuestions),H(null)},re=s=>{const n={...s.question};n?.options&&!Array.isArray(n.options)&&(n.options=Object.values(n.options)),p("question"),b(n),C(s.questionIndex),T(s.timeRemaining||30),H(null)},ae=s=>{p("answer"),s.explanation&&S.success(`Answer: ${s.correctAnswer}`,{duration:4e3})},ie=s=>{p("finished"),P(s.finalResults?.leaderboard||[]),localStorage.setItem("quizResults",JSON.stringify(s.finalResults)),setTimeout(()=>c("/results",{state:s.finalResults}),5e3)},oe=s=>{s.leaderboard&&(P(s.leaderboard),w(n=>n.map(k=>{const R=s.leaderboard.find(ce=>ce.userId===k.userId);return R?{...k,score:R.score}:k})))},le=s=>{U(n=>[...n,s])};o.onParticipantJoined(se),o.onParticipantDisconnected(te),o.onQuizStarted(ne),o.onNextQuestion(re),o.onQuestionCompleted(ae),o.onQuestionTimeUp(s=>{p("answer"),S.error("Time's up!")}),o.onQuizCompleted(ie),o.onLeaderboardUpdate(oe),o.onTimerUpdate(s=>T(s.timeRemaining)),o.onChatMessage(le),o.onSessionEndedByHost(()=>{S("Session ended",{icon:"ðŸ"}),c("/dashboard")})}catch(g){console.error("Session init error:",g),q(g.message||"Failed to initialize session"),S.error("Session Error: "+g.message)}finally{z(!1)}})(),()=>{o.removeAllListeners()}),[c,a,y,i,x]);const{speak:O,stop:V,toggleSpeech:G,speechEnabled:I}=je();t.useEffect(()=>{N==="question"&&u&&I?O(u.text):N!=="question"&&V()},[u,N,I,O,V]);const K=()=>{if(m.length===0){S.error("Wait for at least one player");return}o.startQuiz(l)},Z=()=>{o.endSession(l)},X=()=>{o.nextQuestionForce(l)},Y=r=>{o.kickPlayer(l,r)},ee=r=>{!l||!i||o.sendChatMessage({roomCode:l,userId:i.id||i._id,username:i.username||"Host",message:r,isHost:!0})};return E?e.jsx(be,{text:"Setting up session...",fullScreen:!0,color:"cyan"}):Q?e.jsx("div",{className:"min-h-screen bg-gray-900 flex items-center justify-center p-4",children:e.jsxs("div",{className:"bg-red-900/30 border border-red-500 rounded-xl p-8 max-w-md text-center",children:[e.jsx("h2",{className:"text-xl font-bold text-red-200 mb-4",children:"Connection Error"}),e.jsx("p",{className:"text-gray-300 mb-6",children:Q}),e.jsx("button",{onClick:()=>c("/create-quiz"),className:"px-6 py-2 bg-red-600 rounded-lg text-white font-bold hover:bg-red-700",children:"Back to Create"})]})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-purple-950 to-black text-white p-4 lg:p-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center gap-4 mb-8 bg-gray-800/40 backdrop-blur-md p-6 rounded-2xl border border-white/10",children:[e.jsxs("div",{children:[e.jsx("span",{className:"text-purple-400 font-bold tracking-wider text-sm uppercase",children:"Host Panel"}),e.jsx("h1",{className:"text-3xl font-bold",children:"Quiz Session"})]}),e.jsxs("div",{className:"flex items-center gap-6",children:[e.jsxs("div",{className:"text-center",children:[e.jsx("p",{className:"text-gray-400 text-xs uppercase font-bold",children:"Room Code"}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx("span",{className:"text-4xl font-mono font-bold text-cyan-400 tracking-wider",children:l}),e.jsx("button",{onClick:()=>{navigator.clipboard.writeText(l),S.success("Copied!")},className:"p-2 hover:bg-white/10 rounded-lg transition-colors",children:"ðŸ“‹"})]})]}),e.jsx("div",{className:"h-10 w-px bg-white/10 hidden md:block"}),e.jsxs("div",{className:"text-right hidden md:block",children:[e.jsxs("p",{className:"text-sm text-gray-400",children:["Status: ",e.jsx("span",{className:"text-white capitalize font-bold",children:N})]}),e.jsxs("p",{className:"text-sm text-gray-400",children:["Players: ",e.jsx("span",{className:"text-white font-bold",children:m.length})]})]})]})]}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[!d&&e.jsxs("div",{className:"bg-gray-800/40 backdrop-blur-md border border-white/10 rounded-2xl p-6 min-h-[400px]",children:[e.jsxs("h2",{className:"text-xl font-bold mb-6 flex items-center gap-2",children:[e.jsx("span",{className:"h-2 w-2 rounded-full bg-green-500"}),"Waiting Room (",m.length,")"]}),m.length>0?e.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:m.map(r=>e.jsxs("div",{className:"bg-white/5 border border-white/5 p-3 rounded-xl flex items-center justify-between group",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-gradient-to-r from-purple-500 to-indigo-500 flex items-center justify-center font-bold",children:r.username[0].toUpperCase()}),e.jsx("span",{className:"font-medium truncate max-w-[100px]",children:r.username})]}),e.jsx("button",{onClick:()=>Y(r.userId),className:"opacity-0 group-hover:opacity-100 p-1 hover:bg-red-500/20 text-red-400 rounded transition-all",title:"Kick Player",children:"âœ•"})]},r.userId))}):e.jsxs("div",{className:"flex flex-col items-center justify-center h-64 text-gray-500",children:[e.jsx("div",{className:"w-16 h-16 rounded-full bg-white/5 flex items-center justify-center mb-4 animate-pulse",children:e.jsx("span",{className:"text-2xl",children:"â³"})}),e.jsx("p",{className:"text-lg",children:"Waiting for players to join..."}),e.jsxs("p",{className:"text-sm",children:["Join code: ",e.jsx("span",{className:"text-cyan-400 font-mono",children:l})]})]}),e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsx("button",{onClick:K,disabled:m.length===0,className:"px-8 py-4 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-xl font-bold text-xl shadow-lg shadow-cyan-500/20 hover:scale-105 transition-transform disabled:opacity-50 disabled:scale-100",children:"Start Quiz ðŸš€"})})]}),d&&u&&e.jsxs("div",{className:"bg-gray-800/40 backdrop-blur-md border border-white/10 rounded-2xl p-8 relative overflow-hidden",children:[e.jsx("div",{className:"absolute top-0 left-0 h-1 bg-gradient-to-r from-purple-500 to-cyan-500 transition-all duration-1000",style:{width:`${(j+1)/A*100}%`}}),e.jsxs("div",{className:"flex justify-between items-center mb-6",children:[e.jsxs("span",{className:"bg-white/10 px-3 py-1 rounded-full text-sm font-bold",children:["Question ",j+1," / ",A]}),e.jsxs("div",{className:"flex gap-2",children:[e.jsx("button",{onClick:G,className:`p-2 rounded-full ${I?"bg-cyan-500/20 text-cyan-400":"bg-white/5 text-gray-400"}`,children:I?"ðŸ”Š":"ðŸ”‡"}),e.jsx(fe,{time:v,totalTime:u.timeLimit,isActive:N==="question"})]})]}),e.jsx("h2",{className:"text-2xl md:text-3xl font-bold mb-8 leading-tight",children:u.question}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:u.options?.map((r,g)=>e.jsx("div",{className:`p-4 rounded-xl border-2 transition-all opacity-90
                                        ${N==="answer"&&r.isCorrect?"border-green-500 bg-green-500/20":N==="answer"&&!r.isCorrect?"border-white/5 bg-white/5 opacity-50":"border-white/10 bg-white/5"}
                                    `,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:`w-8 h-8 rounded-full flex items-center justify-center font-bold
                                            ${N==="answer"&&r.isCorrect?"bg-green-500 text-black":"bg-white/10"}
                                        `,children:String.fromCharCode(65+g)}),e.jsx("span",{className:"font-medium text-lg",children:r.text})]})},g))}),N==="answer"&&e.jsxs("div",{className:"mt-8 p-4 bg-green-500/10 border border-green-500/30 rounded-xl",children:[e.jsx("h4",{className:"text-green-400 font-bold mb-1",children:"Answer & Explanation"}),e.jsx("p",{className:"text-gray-300",children:u.explanation||"Correct answer: "+u.correctAnswer})]})]})]}),e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"bg-gray-800/40 backdrop-blur-md border border-white/10 rounded-2xl overflow-hidden flex flex-col h-[400px]",children:[e.jsxs("div",{className:"p-4 border-b border-white/10 bg-white/5 flex justify-between items-center",children:[e.jsx("h3",{className:"text-lg font-bold flex items-center gap-2",children:"ðŸ’¬ Live Chat"}),e.jsx("button",{onClick:()=>{const r=!$;W(r),o.toggleChat(l,r),S.success(`Chat ${r?"enabled":"disabled"}`)},className:`text-xs px-2 py-1 rounded border ${$?"bg-green-500/20 text-green-400 border-green-500/50":"bg-red-500/20 text-red-400 border-red-500/50"}`,children:$?"ON":"OFF"})]}),e.jsx("div",{className:"flex-1 overflow-hidden",children:e.jsx(ye,{messages:B,onSendMessage:ee,currentUser:i})})]}),e.jsxs("div",{className:"bg-gray-800/40 backdrop-blur-md border border-white/10 rounded-2xl p-6",children:[e.jsx("h3",{className:"text-lg font-bold mb-4",children:"Host Controls"}),e.jsxs("div",{className:"space-y-3",children:[N==="question"&&e.jsx("button",{onClick:X,className:"w-full py-3 bg-blue-600 hover:bg-blue-700 rounded-xl font-bold transition-colors",children:"Skip Timer â©"}),e.jsx("button",{onClick:Z,className:"w-full py-3 bg-red-600/20 hover:bg-red-600/40 text-red-400 border border-red-600/50 rounded-xl font-bold transition-colors",children:"End Session ðŸ›‘"})]})]}),e.jsxs("div",{className:"bg-gray-800/40 backdrop-blur-md border border-white/10 rounded-2xl p-6 flex-1 max-h-[500px] flex flex-col",children:[e.jsxs("h3",{className:"text-lg font-bold mb-4 flex items-center justify-between",children:[e.jsx("span",{children:"ðŸ† Leaderboard"}),e.jsx("span",{className:"text-xs text-gray-400 bg-white/5 px-2 py-1 rounded",children:"Live"})]}),e.jsx("div",{className:"space-y-2 overflow-y-auto pr-2 custom-scrollbar flex-1",children:L.length>0?L.map((r,g)=>e.jsxs("div",{className:`flex items-center justify-between p-3 rounded-xl ${g===0?"bg-yellow-500/20 border border-yellow-500/50":"bg-white/5"}`,children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsxs("span",{className:`font-bold w-6 text-center ${g===0?"text-yellow-400":"text-gray-400"}`,children:["#",g+1]}),e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"font-bold text-sm",children:r.username}),e.jsxs("span",{className:"text-xs text-gray-500",children:[r.correctAnswers||0," correct"]})]})]}),e.jsx("span",{className:"font-mono font-bold text-cyan-400",children:r.score})]},r.userId)):e.jsx("div",{className:"text-center py-8 text-gray-500",children:"No scores yet"})})]})]})]})]})})};export{Qe as default};
