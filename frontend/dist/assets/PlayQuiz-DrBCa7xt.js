import{l as O,h as $,b as U,r as s,z as y,j as e,n as M}from"./index-D94il1hI.js";import"./api-DRyY-k3C.js";import{s as n}from"./socketService-B9_9EspU.js";const W=()=>{const{roomCode:m}=O(),g=$(),{user:h}=U(),[o,a]=s.useState("connecting"),[c,N]=s.useState(null),[q,S]=s.useState(0),[C,R]=s.useState(0),[d,b]=s.useState(null),[f,p]=s.useState(30),[z,I]=s.useState(0),[v,k]=s.useState(0),[P,w]=s.useState([]),[T,j]=s.useState(null),[_,F]=s.useState(0);s.useEffect(()=>{(async()=>{try{const t=localStorage.getItem("quizito_token"),u=h?.username||localStorage.getItem("username")||`Guest_${Math.floor(Math.random()*1e3)}`,Q=n.connect(t);n.joinSession(m,u),a("waiting")}catch(t){console.error("Failed to connect:",t),y.error("Connection failed")}})();const r=t=>{console.log("Quiz Started:",t),a("question"),N(t.question),S(t.questionIndex),R(t.totalQuestions),p(t.timeRemaining||30),b(null),j(null)},x=t=>{console.log("Next Question:",t),a("question"),N(t.question),S(t.questionIndex),p(t.timeRemaining||30),b(null),j(null)},l=t=>{console.log("Question Completed:",t),a("answer"),j(t.correctAnswer),t.explanation},A=t=>{console.log("Quiz Completed:",t),a("finished"),w(t.finalResults?.leaderboard||[]),localStorage.setItem("quizResults",JSON.stringify(t.finalResults)),setTimeout(()=>{g(`/results/${t.finalResults?.sessionId}`)},5e3)},L=t=>{const u=t.leaderboard?.find(Q=>Q.username===(h?.username||localStorage.getItem("username")));u&&(I(u.score),k(t.leaderboard.indexOf(u)+1)),w(t.leaderboard||[])};return n.onQuizStarted(r),n.onNextQuestion(x),n.onQuestionCompleted(l),n.onQuizCompleted(A),n.onLeaderboardUpdate(L),n.onTimerUpdate(t=>p(t.timeRemaining)),n.onQuestionTimeUp(()=>{o==="question"&&(a("answer"),y("Time is up!",{icon:"⏰"}))}),n.onSessionEndedByHost(()=>{y.error("Host ended the session"),g("/")}),()=>{n.removeAllListeners()}},[m,h,g]);const E=i=>{if(o!=="question"||d!==null)return;b(i);const r=Math.max(0,30-f);n.submitAnswer({roomCode:m,questionId:c._id,selectedOption:i,timeTaken:r})};return o==="connecting"?e.jsx(M,{text:"Joining session...",fullScreen:!0,color:"purple"}):o==="waiting"?e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-indigo-900 to-purple-900 flex flex-col items-center justify-center text-white p-4",children:[e.jsx("div",{className:"text-center animate-bounce mb-8",children:e.jsx("div",{className:"text-6xl mb-4",children:"⏳"})}),e.jsx("h1",{className:"text-4xl font-bold mb-4",children:"You're In!"}),e.jsx("p",{className:"text-xl opacity-80 mb-8",children:"Waiting for host to start..."}),e.jsx("div",{className:"bg-white/10 px-6 py-4 rounded-xl border border-white/20",children:e.jsx("p",{className:"font-mono text-cyan-300 text-xl",children:m})})]}):e.jsxs("div",{className:"min-h-screen bg-gray-900 text-white p-4",children:[e.jsxs("div",{className:"max-w-3xl mx-auto flex justify-between items-center mb-8 bg-gray-800/50 p-4 rounded-xl backdrop-blur-sm",children:[e.jsxs("div",{className:"flex flex-col",children:[e.jsx("span",{className:"text-xs text-gray-400 uppercase font-bold",children:"Score"}),e.jsx("span",{className:"text-2xl font-bold text-yellow-400",children:z}),v>0&&e.jsxs("span",{className:"text-xs text-green-400",children:["Rank #",v]})]}),e.jsxs("div",{className:"flex flex-col items-end",children:[e.jsx("span",{className:"text-xs text-gray-400 uppercase font-bold",children:"Question"}),e.jsxs("span",{className:"text-xl font-bold",children:[q+1," ",e.jsxs("span",{className:"text-sm text-gray-500",children:["/ ",C]})]})]})]}),e.jsx("div",{className:"max-w-3xl mx-auto",children:o==="question"||o==="answer"?e.jsxs("div",{className:"bg-gray-800 rounded-2xl shadow-2xl overflow-hidden border border-gray-700",children:[e.jsx("div",{className:"h-2 bg-gray-700 w-full",children:e.jsx("div",{className:`h-full transition-all duration-1000 ${f<10?"bg-red-500":"bg-cyan-500"}`,style:{width:`${f/(c?.timeLimit||30)*100}%`}})}),e.jsxs("div",{className:"p-6 md:p-8",children:[e.jsx("h2",{className:"text-2xl md:text-3xl font-bold mb-8 leading-tight",children:c?.question||c?.text}),e.jsx("div",{className:"grid grid-cols-1 gap-4",children:c?.options?.map((i,r)=>{const x=typeof i=="object"?i.text:i;let l="bg-gray-700 hover:bg-gray-600 border-gray-600";return o==="answer"?i.isCorrect||T===x?l="bg-green-600 border-green-500":d===r?l="bg-red-600 border-red-500":l="bg-gray-700 opacity-50":d===r&&(l="bg-cyan-600 border-cyan-400 ring-2 ring-cyan-400"),e.jsx("button",{onClick:()=>E(r),disabled:o!=="question"||d!==null,className:`p-4 md:p-6 rounded-xl border-2 text-left transition-all transform ${l} ${o==="question"&&d===null?"hover:scale-[1.02]":""}`,children:e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:"w-8 h-8 rounded-full bg-white/10 flex items-center justify-center font-bold text-sm",children:String.fromCharCode(65+r)}),e.jsx("span",{className:"font-semibold text-lg",children:x})]})},r)})})]}),o==="answer"&&e.jsx("div",{className:"bg-gray-900/50 p-4 text-center border-t border-gray-700",children:e.jsx("p",{className:"text-gray-400 italic",children:"Waiting for next question..."})})]}):o==="finished"?e.jsxs("div",{className:"text-center py-12",children:[e.jsx("h2",{className:"text-4xl font-bold mb-4",children:"Quiz Finished!"}),e.jsx("p",{className:"text-xl text-gray-400",children:"Redirecting to results..."})]}):null})]})};export{W as default};
