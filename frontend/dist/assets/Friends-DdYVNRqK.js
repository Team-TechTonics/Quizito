import{c as E,b as I,r,z as i,j as e,m as x,U as b,X as T,C as _,W as C}from"./index-D94il1hI.js";import"./api-DRyY-k3C.js";import{s as n}from"./socialService-Cys_4En9.js";import{L as O}from"./loader-68blDsed.js";import{S as P}from"./swords-BFCSXTvl.js";import{C as Q}from"./check-BaxY6Fgs.js";import{S as G}from"./search-BIwijdH4.js";const W=E("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]),ee=()=>{const{user:X}=I(),[c,g]=r.useState("friends"),[m,R]=r.useState(""),[d,q]=r.useState([]),[l,h]=r.useState({incoming:[],outgoing:[]}),[p,y]=r.useState([]),[j,f]=r.useState([]),[z,v]=r.useState(!0),[N,w]=r.useState(!1);r.useEffect(()=>{S()},[]);const S=async()=>{v(!0);try{const[s,t,a]=await Promise.all([n.getFriends(),n.getFriendRequests(),n.getSuggestedFriends()]);q(s||[]),h({incoming:t?.incoming||[],outgoing:t?.outgoing||[]}),y(a||[])}catch(s){console.error("Failed to fetch friends data:",s),i.error("Could not load social data")}finally{v(!1)}},L=async s=>{if(s.preventDefault(),!!m.trim()){w(!0);try{const t=await n.searchUsers(m);f(t||[])}catch(t){console.error("Search failed:",t),i.error("Search failed")}finally{w(!1)}}},F=async s=>{try{await n.sendFriendRequest(s),i.success("Friend request sent!");const t=await n.getFriendRequests();h(a=>({...a,outgoing:t.outgoing})),y(a=>a.filter(o=>o.id!==s)),f(a=>a.map(o=>o.id===s?{...o,requestSent:!0}:o))}catch(t){console.error("Failed to send request:",t),i.error(t.message||"Failed to send request")}},D=async s=>{try{await n.acceptFriendRequest(s),i.success("Friend request accepted!"),S()}catch(t){console.error("Failed to accept request:",t),i.error("Failed to accept request")}},$=async s=>{try{await n.declineFriendRequest(s),i.success("Friend request declined"),h(t=>({...t,incoming:t.incoming.filter(a=>a.id!==s)}))}catch(t){console.error("Failed to decline request:",t),i.error("Failed to decline request")}},k=async s=>{i("Functionality coming soon")},A=s=>{switch(s){case"online":return"bg-green-500";case"away":return"bg-yellow-500";default:return"bg-gray-400"}},M=(s,t)=>{if(s==="online")return"Online";if(s==="away")return"Away";if(!t)return"Offline";const a=new Date(t),U=new Date-a,u=Math.floor(U/(1e3*60*60));return u<24?`${u}h ago`:`${Math.floor(u/24)}d ago`};return z?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 flex items-center justify-center",children:e.jsx(O,{className:"animate-spin text-indigo-600",size:48})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-blue-50 py-8 px-4",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs(x.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsxs("h1",{className:"text-4xl font-bold text-gray-800 mb-2 flex items-center",children:[e.jsx(b,{className:"mr-3 text-indigo-600",size:40}),"Friends"]}),e.jsx("p",{className:"text-gray-600",children:"Connect with other learners and compete together"})]}),e.jsxs("div",{className:"flex space-x-2 mb-8",children:[e.jsxs("button",{onClick:()=>g("friends"),className:`px-6 py-3 rounded-xl font-semibold transition-all ${c==="friends"?"bg-indigo-500 text-white shadow-lg":"bg-white text-gray-700 hover:bg-gray-100"}`,children:["My Friends (",d.length,")"]}),e.jsxs("button",{onClick:()=>g("requests"),className:`px-6 py-3 rounded-xl font-semibold transition-all relative ${c==="requests"?"bg-indigo-500 text-white shadow-lg":"bg-white text-gray-700 hover:bg-gray-100"}`,children:["Requests",l.incoming.length>0&&e.jsx("span",{className:"absolute -top-2 -right-2 bg-red-500 text-white text-xs font-bold rounded-full w-6 h-6 flex items-center justify-center",children:l.incoming.length})]}),e.jsx("button",{onClick:()=>g("find"),className:`px-6 py-3 rounded-xl font-semibold transition-all ${c==="find"?"bg-indigo-500 text-white shadow-lg":"bg-white text-gray-700 hover:bg-gray-100"}`,children:"Find Friends"})]}),c==="friends"&&e.jsx("div",{children:d.length===0?e.jsxs("div",{className:"text-center py-12 text-gray-500 bg-white rounded-2xl shadow-lg",children:[e.jsx(b,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("h3",{className:"text-xl font-bold mb-2",children:"No friends yet"}),e.jsx("p",{children:'Go to "Find Friends" to connect with people!'})]}):e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:d.map((s,t)=>e.jsxs(x.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:t*.05},className:"bg-white rounded-2xl shadow-lg p-6 hover:shadow-xl transition-shadow",children:[e.jsx("div",{className:"flex items-start justify-between mb-4",children:e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsxs("div",{className:"relative",children:[e.jsx("img",{src:s.avatar||`https://api.dicebear.com/7.x/avataaars/svg?seed=${s.username}`,alt:s.username,className:"w-16 h-16 rounded-full border-4 border-gray-100"}),e.jsx("div",{className:`absolute bottom-0 right-0 w-4 h-4 ${A(s.status)} rounded-full border-2 border-white`})]}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-lg text-gray-800",children:s.username}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Level ",s.level||1]}),e.jsx("p",{className:"text-xs text-gray-500",children:M(s.status,s.lastSeen)})]})]})}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 bg-indigo-500 text-white rounded-xl hover:bg-indigo-600 transition-colors",children:[e.jsx(P,{size:16}),e.jsx("span",{children:"Challenge"})]}),e.jsxs("button",{className:"flex-1 flex items-center justify-center space-x-2 px-4 py-2 border-2 border-gray-200 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors",children:[e.jsx(W,{size:16}),e.jsx("span",{children:"Message"})]})]})]},s.userId||s.id))})}),c==="requests"&&e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:["Incoming Requests (",l.incoming.length,")"]}),e.jsxs("div",{className:"space-y-4",children:[l.incoming.map((s,t)=>e.jsx(x.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:t*.05},className:"bg-white rounded-2xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("img",{src:s.from?.avatar||`https://api.dicebear.com/7.x/avataaars/svg?seed=${s.from?.username}`,alt:s.from?.username,className:"w-14 h-14 rounded-full border-2 border-gray-200"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-800",children:s.from?.username}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Level ",s.from?.level||1]}),e.jsx("p",{className:"text-xs text-gray-400 mt-1",children:new Date(s.createdAt).toLocaleDateString()})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsxs("button",{onClick:()=>D(s.id),className:"flex items-center space-x-2 px-4 py-2 bg-green-500 text-white rounded-xl hover:bg-green-600 transition-colors",children:[e.jsx(Q,{size:16}),e.jsx("span",{children:"Accept"})]}),e.jsxs("button",{onClick:()=>$(s.id),className:"flex items-center space-x-2 px-4 py-2 bg-red-500 text-white rounded-xl hover:bg-red-600 transition-colors",children:[e.jsx(T,{size:16}),e.jsx("span",{children:"Decline"})]})]})]})},s.id)),l.incoming.length===0&&e.jsxs("div",{className:"text-center py-12 text-gray-500 bg-white rounded-2xl shadow-sm",children:[e.jsx(b,{size:48,className:"mx-auto mb-4 opacity-50"}),e.jsx("p",{children:"No pending friend requests"})]})]})]}),e.jsxs("div",{children:[e.jsxs("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:["Sent Requests (",l.outgoing.length,")"]}),e.jsx("div",{className:"space-y-4",children:l.outgoing.map((s,t)=>e.jsx(x.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{delay:t*.05},className:"bg-white rounded-2xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("img",{src:s.to?.avatar||`https://api.dicebear.com/7.x/avataaars/svg?seed=${s.to?.username}`,alt:s.to?.username,className:"w-14 h-14 rounded-full border-2 border-gray-200"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-bold text-gray-800",children:s.to?.username}),e.jsxs("p",{className:"text-sm text-gray-600",children:["Level ",s.to?.level||1]}),e.jsxs("p",{className:"text-xs text-gray-400 mt-1 flex items-center",children:[e.jsx(_,{size:12,className:"mr-1"}),"Sent ",new Date(s.createdAt).toLocaleDateString()]})]})]}),e.jsx("button",{onClick:()=>k(s.id),className:"px-4 py-2 border-2 border-gray-300 text-gray-700 rounded-xl hover:bg-gray-50 transition-colors",children:"Cancel Request"})]})},s.id))})]})]}),c==="find"&&e.jsxs("div",{children:[e.jsx("div",{className:"mb-6",children:e.jsxs("form",{onSubmit:L,className:"relative",children:[e.jsx(G,{className:"absolute left-4 top-1/2 transform -translate-y-1/2 text-gray-400",size:20}),e.jsx("input",{type:"text",placeholder:"Search by username (e.g. 'john_doe')",value:m,onChange:s=>R(s.target.value),className:"w-full pl-12 pr-32 py-3 bg-white rounded-xl border border-gray-200 focus:outline-none focus:ring-2 focus:ring-indigo-500"}),e.jsx("button",{type:"submit",disabled:N,className:"absolute right-2 top-1/2 transform -translate-y-1/2 px-6 py-1.5 bg-indigo-500 text-white rounded-lg hover:bg-indigo-600 disabled:opacity-50",children:N?"Searching...":"Search"})]})}),j.length>0&&e.jsxs("div",{className:"mb-8",children:[e.jsx("h2",{className:"text-xl font-bold text-gray-800 mb-4",children:"Search Results"}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:j.map(s=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 text-center",children:[e.jsx("img",{src:s.avatar||`https://api.dicebear.com/7.x/avataaars/svg?seed=${s.username}`,alt:s.username,className:"w-20 h-20 rounded-full mx-auto mb-4 border-4 border-gray-100"}),e.jsx("h3",{className:"font-bold text-gray-800 mb-1",children:s.username}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Level ",s.level||1]}),d.some(t=>t.userId===s.id)?e.jsx("button",{disabled:!0,className:"w-full px-4 py-2 bg-green-100 text-green-700 rounded-xl cursor-default",children:"Already Friends"}):s.requestSent?e.jsx("button",{disabled:!0,className:"w-full px-4 py-2 bg-gray-100 text-gray-500 rounded-xl cursor-default",children:"Request Sent"}):e.jsxs("button",{onClick:()=>F(s.id||s._id),className:"w-full flex items-center justify-center space-x-2 px-4 py-2 bg-indigo-500 text-white rounded-xl hover:bg-indigo-600 transition-colors",children:[e.jsx(C,{size:16}),e.jsx("span",{children:"Add Friend"})]})]},s.id||s._id))})]}),e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Suggested Friends"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:[p.map((s,t)=>e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6 text-center",children:[e.jsx("img",{src:s.avatar||`https://api.dicebear.com/7.x/avataaars/svg?seed=${s.username}`,alt:s.username,className:"w-20 h-20 rounded-full mx-auto mb-4 border-4 border-gray-100"}),e.jsx("h3",{className:"font-bold text-gray-800 mb-1",children:s.username}),e.jsxs("p",{className:"text-sm text-gray-600 mb-4",children:["Level ",s.level||1]}),e.jsxs("button",{onClick:()=>F(s.id),className:"w-full flex items-center justify-center space-x-2 px-4 py-2 bg-indigo-500 text-white rounded-xl hover:bg-indigo-600 transition-colors",children:[e.jsx(C,{size:16}),e.jsx("span",{children:"Add Friend"})]})]},s.id||`suggested-${t}`)),p.length===0&&e.jsx("div",{className:"col-span-full text-center py-8 text-gray-500 bg-white rounded-xl",children:e.jsx("p",{children:"No suggestions available at the moment."})})]})]})]})})};export{ee as default};
