import{b as D,h as L,r as c,z as n,j as e,m as p,T as g,p as A,C as q,P as F,X as y,L as T}from"./index-D94il1hI.js";import"./api-DRyY-k3C.js";import{s as j}from"./socialService-Cys_4En9.js";import{L as $}from"./loader-68blDsed.js";import{S as d}from"./swords-BFCSXTvl.js";import{T as I}from"./trending-up-CDV_flEY.js";import{C as E}from"./check-BaxY6Fgs.js";const U=()=>{const{user:t}=D();L();const[r,x]=c.useState("active"),[o,N]=c.useState([]),[v,u]=c.useState(!0);c.useEffect(()=>{m()},[]);const m=async()=>{u(!0);try{const s=await j.getChallenges();N(s||[])}catch(s){console.error("Failed to fetch challenges:",s),n.error("Failed to load challenges")}finally{u(!1)}},w=async s=>{try{await j.acceptChallenge(s),n.success("Challenge accepted! Starting quiz..."),m()}catch(i){console.error("Failed to accept challenge:",i),n.error("Failed to accept challenge")}},C=async s=>{try{await j.declineChallenge(s),n.success("Challenge declined"),m()}catch(i){console.error("Failed to decline challenge:",i),n.error("Failed to decline challenge")}},h=o.filter(s=>s.status==="pending"||s.status==="active"),l=o.filter(s=>s.status==="completed"),b=o.length,f=l.filter(s=>s.winner===t?.id||s.winner==="you").length,z=b>0&&Math.round(f/l.length*100)||0,k=t?.stats?.streak||0,S=s=>{switch(s?.toLowerCase()){case"easy":return"bg-green-100 text-green-700";case"medium":return"bg-amber-100 text-amber-700";case"hard":return"bg-red-100 text-red-700";default:return"bg-gray-100 text-gray-700"}};return v?e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-purple-50 flex items-center justify-center",children:e.jsx($,{className:"animate-spin text-purple-600",size:48})}):e.jsx("div",{className:"min-h-screen bg-gradient-to-br from-gray-50 to-purple-50 py-8 px-4",children:e.jsxs("div",{className:"container mx-auto max-w-6xl",children:[e.jsxs(p.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-8",children:[e.jsxs("h1",{className:"text-4xl font-bold text-gray-800 mb-2 flex items-center",children:[e.jsx(d,{className:"mr-3 text-purple-600",size:40}),"Challenges"]}),e.jsx("p",{className:"text-gray-600",children:"Compete head-to-head with your friends"})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4 mb-8",children:[e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Total Challenges"}),e.jsx("p",{className:"text-3xl font-bold text-indigo-600",children:b})]}),e.jsx(d,{className:"text-indigo-600",size:32})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Wins"}),e.jsx("p",{className:"text-3xl font-bold text-green-600",children:f})]}),e.jsx(g,{className:"text-green-600",size:32})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Win Rate"}),e.jsxs("p",{className:"text-3xl font-bold text-purple-600",children:[z,"%"]})]}),e.jsx(A,{className:"text-purple-600",size:32})]})}),e.jsx("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-gray-600 text-sm",children:"Win Streak"}),e.jsx("p",{className:"text-3xl font-bold text-orange-600",children:k})]}),e.jsx(I,{className:"text-orange-600",size:32})]})})]}),e.jsxs("div",{className:"flex space-x-2 mb-8",children:[e.jsxs("button",{onClick:()=>x("active"),className:`px-6 py-3 rounded-xl font-semibold transition-all ${r==="active"?"bg-purple-500 text-white shadow-lg":"bg-white text-gray-700 hover:bg-gray-100"}`,children:["Active (",h.length,")"]}),e.jsx("button",{onClick:()=>x("completed"),className:`px-6 py-3 rounded-xl font-semibold transition-all ${r==="completed"?"bg-purple-500 text-white shadow-lg":"bg-white text-gray-700 hover:bg-gray-100"}`,children:"Completed"}),e.jsx("button",{onClick:()=>x("history"),className:`px-6 py-3 rounded-xl font-semibold transition-all ${r==="history"?"bg-purple-500 text-white shadow-lg":"bg-white text-gray-700 hover:bg-gray-100"}`,children:"History"})]}),r==="active"&&e.jsxs("div",{className:"space-y-6",children:[h.map(s=>e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},className:"bg-gradient-to-br from-purple-500 to-indigo-600 rounded-2xl shadow-2xl p-8 text-white mb-8",children:[e.jsxs("div",{className:"flex items-center justify-between mb-6",children:[e.jsxs("div",{children:[e.jsxs("h2",{className:"text-3xl font-bold mb-2",children:["Challenge from ",s.challenger?.username||"Opponent"]}),e.jsx("p",{className:"text-purple-100",children:"You've been challenged to a quiz duel!"})]}),e.jsx(d,{size:48,className:"text-purple-200"})]}),e.jsxs("div",{className:"bg-white/10 backdrop-blur-sm rounded-xl p-6 mb-6",children:[e.jsx("h3",{className:"text-xl font-bold mb-4",children:s.quiz?.title||"Quiz Challenge"}),e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-200 text-sm mb-1",children:"Difficulty"}),e.jsx("p",{className:"font-semibold capitalize",children:s.quiz?.difficulty||"Medium"})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-200 text-sm mb-1",children:"Wager"}),e.jsxs("p",{className:"font-semibold",children:[s.wager," XP"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-200 text-sm mb-1",children:"Expires In"}),e.jsxs("p",{className:"font-semibold flex items-center",children:[e.jsx(q,{size:16,className:"mr-1"}),"24h"]})]}),e.jsxs("div",{children:[e.jsx("p",{className:"text-purple-200 text-sm mb-1",children:"Created"}),e.jsx("p",{className:"font-semibold",children:new Date(s.createdAt).toLocaleDateString()})]})]})]}),e.jsxs("div",{className:"flex space-x-4",children:[e.jsxs("button",{onClick:()=>w(s.id||s._id),className:"flex-1 flex items-center justify-center space-x-2 px-6 py-4 bg-white text-purple-600 rounded-xl font-bold hover:bg-purple-50 transition-colors",children:[e.jsx(F,{size:20}),e.jsx("span",{children:"Accept Challenge"})]}),e.jsxs("button",{onClick:()=>C(s.id||s._id),className:"flex items-center justify-center space-x-2 px-6 py-4 bg-red-500 text-white rounded-xl font-bold hover:bg-red-600 transition-colors",children:[e.jsx(y,{size:20}),e.jsx("span",{children:"Decline"})]})]})]},s.id||s._id)),h.length===0&&e.jsxs("div",{className:"text-center py-16 bg-white rounded-2xl shadow-lg",children:[e.jsx(d,{size:64,className:"mx-auto mb-4 text-gray-300"}),e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-2",children:"No Active Challenges"}),e.jsx("p",{className:"text-gray-600",children:"Challenge a friend to start competing!"}),e.jsx(T,{to:"/friends",className:"inline-block mt-4 px-6 py-2 bg-indigo-500 text-white rounded-xl font-semibold hover:bg-indigo-600 transition-colors",children:"Find Friends to Challenge"})]})]}),r==="completed"&&e.jsxs("div",{className:"space-y-4",children:[l.map((s,i)=>e.jsxs(p.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{delay:i*.05},className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{children:[e.jsx("h3",{className:"text-xl font-bold text-gray-800 mb-1",children:s.quiz?.title}),e.jsx("p",{className:"text-sm text-gray-600",children:new Date(s.createdAt).toLocaleDateString()})]}),e.jsx("span",{className:`px-4 py-2 rounded-full text-sm font-bold ${S(s.quiz?.difficulty)}`,children:s.quiz?.difficulty?.toUpperCase()||"MEDIUM"})]}),e.jsxs("div",{className:"grid grid-cols-3 gap-4 items-center mb-4",children:[e.jsxs("div",{className:`text-center p-4 rounded-xl ${s.winner===t?.id?"bg-green-50 border-2 border-green-500":"bg-gray-50"}`,children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"You"}),e.jsxs("p",{className:"text-3xl font-bold text-gray-800",children:[s.results?.find(a=>a.userId===t?.id)?.score||0,"%"]}),s.winner===t?.id&&e.jsx("div",{className:"mt-2 text-center w-full flex justify-center",children:e.jsx(g,{className:"inline text-yellow-500",size:24})})]}),e.jsxs("div",{className:"text-center",children:[e.jsx(d,{className:"mx-auto text-gray-400",size:32}),e.jsx("p",{className:"text-sm font-bold text-gray-600 mt-2",children:"VS"})]}),e.jsxs("div",{className:`text-center p-4 rounded-xl ${s.winner&&s.winner!==t?.id?"bg-green-50 border-2 border-green-500":"bg-gray-50"}`,children:[e.jsx("p",{className:"text-sm text-gray-600 mb-2",children:s.opponent?.username||"Opponent"}),e.jsxs("p",{className:"text-3xl font-bold text-gray-800",children:[s.results?.find(a=>a.userId!==t?.id)?.score||0,"%"]}),s.winner&&s.winner!==t?.id&&e.jsx("div",{className:"mt-2 text-center w-full flex justify-center",children:e.jsx(g,{className:"inline text-yellow-500",size:24})})]})]}),e.jsx("div",{className:`text-center p-4 rounded-xl ${s.winner===t?.id?"bg-green-100":"bg-red-100"}`,children:s.winner===t?.id?e.jsxs("p",{className:"font-bold text-green-700",children:["ðŸŽ‰ You Won! +",s.wager," XP"]}):e.jsxs("p",{className:"font-bold text-red-700",children:["You Lost -",s.wager," XP"]})})]},s.id||s._id)),l.length===0&&e.jsx("div",{className:"text-center py-12 text-gray-500 bg-white rounded-2xl shadow-lg",children:e.jsx("p",{children:"No completed challenges yet."})})]}),r==="history"&&e.jsxs("div",{className:"bg-white rounded-2xl shadow-lg p-6",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Challenge History"}),e.jsx("div",{className:"space-y-3",children:l.length>0?[...l].reverse().map((s,i)=>e.jsxs("div",{className:"flex items-center justify-between p-4 bg-gray-50 rounded-xl",children:[e.jsxs("div",{className:"flex items-center space-x-4",children:[e.jsx("div",{className:`w-12 h-12 rounded-full flex items-center justify-center ${s.winner===t?.id?"bg-green-100":"bg-red-100"}`,children:s.winner===t?.id?e.jsx(E,{className:"text-green-600",size:24}):e.jsx(y,{className:"text-red-600",size:24})}),e.jsxs("div",{children:[e.jsxs("p",{className:"font-semibold text-gray-800",children:["vs ",s.opponent?.username]}),e.jsx("p",{className:"text-sm text-gray-600",children:s.quiz?.title})]})]}),e.jsxs("div",{className:"text-right",children:[e.jsxs("p",{className:"font-bold text-gray-800",children:[s.results?.find(a=>a.userId===t?.id)?.score||0,"% - ",s.results?.find(a=>a.userId!==t?.id)?.score||0,"%"]}),e.jsx("p",{className:"text-sm text-gray-600",children:new Date(s.createdAt).toLocaleDateString()})]})]},i)):e.jsx("p",{className:"text-gray-500 text-center py-4",children:"No challenge history available."})})]})]})})};export{U as default};
